var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,n=(e,l)=>{for(var a in l||(l={}))o.call(l,a)&&s(e,a,l[a]);if(t)for(var a of t(l))r.call(l,a)&&s(e,a,l[a]);return e},i=(e,t)=>l(e,a(t));import{r as c,u}from"./index.ebc87d0b.js";import{a7 as d,u as m,c as p,r as f,av as b,b0 as g,v,aJ as j,aK as _,b6 as h,aB as y,Z as k,a5 as C,b4 as w,_ as z,D as N,aE as S,aC as V,a4 as x,k as R,X as E,Y as O}from"./@vue.9dcf4325.js";import{h as P}from"./element-plus.c35c14b5.js";import"./vuex.110f31c1.js";import"./js-cookie.aa728e12.js";import"./vue-router.5a690d96.js";import"./css-color-function.a5ba1304.js";import"./color.ccf836c3.js";import"./clone.05e42b91.js";import"./color-convert.755d189f.js";import"./color-name.e7a4e1d3.js";import"./color-string.e356f5de.js";import"./ms.ba588bd8.js";import"./path-to-regexp.2b09bab4.js";import"./fuse.js.c1e3c562.js";import"./path.8db65c51.js";import"./util.3d699e40.js";import"./axios.a57df465.js";import"./dayjs.80b0a338.js";import"./mockjs.26632a98.js";import"./lodash.a533b6d4.js";import"./resize-observer-polyfill.af5c5caa.js";import"./@popperjs.b42a2641.js";import"./mitt.06a3009f.js";import"./async-validator.9224cb80.js";import"./normalize-wheel.1d574cd1.js";import"./vue.1f809ab3.js";const D="/api/auth/permission/routes";var M=d({name:"RolesEdit",props:{currentRole:{type:Object,default:()=>({roleName:"",state:1})}},emits:["success"],setup(e,{emit:l}){const a=m(e,"currentRole"),t=u(),o=p((()=>t.getters["settingsModule/getLangState"])),r=f({url:"/role/allow",purl:"/role/permissions",loading:!1,form:{key:"",label:""},menu:{loading:!1,url:"/menu/list",data:[],form:[]}}),s=p((()=>a.value.role)),d=p((()=>t.state.permissionModule.routes)),j=async()=>{const e={roleName:s.value.roleName},l=await class{static postAuthPermission(e){return c({url:D,method:"POST",json:!0,data:e}).then((e=>(console.log(e),0===e.status?Promise.resolve(e):Promise.reject(e))))}}.postAuthPermission(e);if(null==l?void 0:l.data){const{authedRoutes:e}=l.data;r.menu.form=e}},_=()=>{var e,l;for(const a of d.value)(null==(e=null==a?void 0:a.meta)?void 0:e.hidden)||r.menu.data.push({key:null==a?void 0:a.path,label:null==(l=null==a?void 0:a.meta)?void 0:l.title[o.value]})};return b((()=>{_()})),g((()=>{j()})),i(n({},v(r)),{lang:o,role:s,fetchMenuData:_,saveData:()=>{console.log("form is ",r.menu.form),l("success")}})}});const T=e=>(S("data-v-7247ff70"),e=e(),V(),e),U={class:"wrapper"},B={class:"card-header"},A=T((()=>z("br",null,null,-1))),F=T((()=>z("i",{class:"fa fa-check"},null,-1))),I=x(" 确认修改 ");M.render=function(e,l,a,t,o,r){const s=j("el-form-item"),n=j("el-form"),i=j("el-transfer"),c=j("el-card"),u=j("el-button"),d=j("el-row"),m=_("loading");return h((y(),k("div",U,[C(c,{class:"transfer"},{header:w((()=>[z("span",null,[z("div",B,[C(n,{"label-position":"left",inline:"",class:"info-table"},{default:w((()=>[C(s,{label:"名称"},{default:w((()=>[z("span",null,N(e.role.roleName),1)])),_:1})])),_:1})])])])),default:w((()=>[h(C(i,{modelValue:e.menu.form,"onUpdate:modelValue":l[0]||(l[0]=l=>e.menu.form=l),data:e.menu.data,titles:["菜单","已授权"]},null,8,["modelValue","data"]),[[m,e.menu.loading]])])),_:1}),A,C(d,{class:"btns"},{default:w((()=>[C(u,{size:"mini",type:"primary",disabled:0==e.role.state,onClick:e.saveData},{default:w((()=>[F,I])),_:1},8,["disabled","onClick"])])),_:1})],512)),[[m,e.loading]])},M.__scopeId="data-v-7247ff70";var $=d({name:"RoleNew",emits:["success"],setup(e,{emit:l}){const a=R(),t=f({form:{roleName:"",remark:""},loading:!1});return n({submitForm:()=>{a.value.validate((e=>e?(l("success",n({},t.form)),!0):(console.log("error submit!!"),!1)))},rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}]},formRef:a,url:"/role/add"},v(t))}});const q={class:"new"},J=z("i",{class:"fa fa-plus"},null,-1),K=x(" 新增 ");$.render=function(e,l,a,t,o,r){const s=j("el-input"),n=j("el-form-item"),i=j("el-button"),c=j("el-row"),u=j("el-form"),d=_("loading");return h((y(),k("div",q,[C(u,{ref:"formRef",model:e.form,rules:e.rules,"label-position":"right","label-width":"100px"},{default:w((()=>[C(n,{label:"角色名称",prop:"roleName"},{default:w((()=>[C(s,{modelValue:e.form.roleName,"onUpdate:modelValue":l[0]||(l[0]=l=>e.form.roleName=l),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),C(n,{label:"备注"},{default:w((()=>[C(s,{modelValue:e.form.remark,"onUpdate:modelValue":l[1]||(l[1]=l=>e.form.remark=l),placeholder:"请输入备注"},null,8,["modelValue"])])),_:1}),C(c,{class:"btn-container"},{default:w((()=>[C(i,{size:"mini",type:"primary",onClick:l[2]||(l[2]=l=>e.submitForm())},{default:w((()=>[J,K])),_:1})])),_:1})])),_:1},8,["model","rules"])],512)),[[d,e.loading]])};var L=d({name:"RoleManage",components:{RoleEdit:M,RoleNew:$},setup(){const e=f({url:{c:"/role/add",r:"/role/list",u:"/role/update",d:"/role/delete"},param:{limit:10,page:1},data:[{roleName:"超级管理员",remark:"拥有删除和创建等操作的权限",state:0},{roleName:"管理员",remark:"拥有创建和权限分配的权限",state:0},{roleName:"游客",remark:"只拥有操作部分菜单的权限",state:1}],loading:!1,is_search:!1,add_visible:!1,edit_visible:!1,detail_visible:!1,posted:{role:{roleName:"",state:1}}}),l=p((()=>e.data.length));return i(n({},v(e)),{total:l,onCurrentChange:()=>{},onSizeChange:l=>{e.param.limit=l},onCreate:()=>{e.add_visible=!0},onCreateSuccess:l=>{console.log(l);const a={roleName:l.roleName,remark:l.remark,state:1};e.data.push(a),e.add_visible=!1},onEditSuccess:()=>{e.edit_visible=!1},onRefresh:()=>{e.is_search=!1},onEdit:(l,a)=>{console.log("row",a),e.posted.role=a,e.edit_visible=!0},onDelete:(e,l)=>{console.log(e,l),(e=>{console.log(e),P.ElMessageBox.confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{P.ElMessage({type:"success",message:"删除成功"})})).catch((()=>{P.ElMessage({type:"info",message:"已取消删除"})}))})(e)}})}});const X=x("新增"),Y=x("刷新"),Z=z("br",null,null,-1),G=z("i",{class:"ic ic-lock"},null,-1),H=x(" 锁定"),Q=x("正常"),W=x("未知"),ee={class:"pagination"};L.render=function(e,l,a,t,o,r){const s=j("el-alert"),n=j("el-button"),i=j("el-col"),c=j("el-row"),u=j("el-table-column"),d=j("el-tag"),m=j("el-tooltip"),p=j("el-table"),f=j("el-pagination"),b=j("el-card"),g=j("role-edit"),v=j("el-dialog"),N=j("role-new"),S=_("loading");return y(),k("div",null,[C(s,{title:"Tips:点击【新增】按钮进行新增角色；点击【编辑】按钮，进行不同角色的菜单授权操作！",type:"warning"}),C(s,{title:"Tips:权限控制体验：【管理员账号为：admin@outlook.com】、【超级管理员账号为：super@outlook.com】",type:"info"}),C(b,{class:"card-ctrl"},{default:w((()=>[C(c,null,{default:w((()=>[C(i,{span:8,style:{"text-align":"left"}},{default:w((()=>[C(n,{type:"primary",icon:"el-icon-plus",size:"small",onClick:e.onCreate},{default:w((()=>[X])),_:1},8,["onClick"]),C(n,{type:"success",icon:"el-icon-refresh",size:"small",onClick:e.onRefresh},{default:w((()=>[Y])),_:1},8,["onClick"])])),_:1})])),_:1}),Z,h(C(p,{data:e.data,stripe:"",class:"table"},{default:w((()=>[C(u,{prop:"roleName",label:"角色名称",align:"center"}),C(u,{prop:"state",label:"角色状态",align:"center"},{default:w((e=>[0==e.row.state?(y(),E(d,{key:0,size:"mini",type:"info"},{default:w((()=>[G,H])),_:1})):1==e.row.state?(y(),E(d,{key:1,size:"mini",type:"success"},{default:w((()=>[Q])),_:1})):(y(),E(d,{key:2,size:"mini",type:"danger"},{default:w((()=>[W])),_:1}))])),_:1}),C(u,{prop:"remark",label:"备注",align:"center"}),C(u,{label:"操作",align:"center"},{default:w((l=>[C(m,{class:"item",effect:"dark",content:"菜单授权",placement:"bottom"},{default:w((()=>[C(n,{circle:"",plain:"",type:"primary",icon:"el-icon-edit",size:"small",onClick:a=>e.onEdit(l.$index,l.row)},null,8,["onClick"])])),_:2},1024),0!=l.row.state?(y(),E(m,{key:0,class:"item",effect:"dark",content:"删除",placement:"bottom"},{default:w((()=>[C(n,{circle:"",plain:"",type:"danger",icon:"el-icon-minus",size:"small",onClick:a=>e.onDelete(l.$index,l.row)},null,8,["onClick"])])),_:2},1024)):O("",!0)])),_:1})])),_:1},8,["data"]),[[S,e.loading]]),z("div",ee,[C(f,{"current-page":e.param.page,"page-size":e.param.limit,layout:"sizes,prev,pager,next,total","page-sizes":[5,10,20],total:e.total,background:"",onCurrentChange:e.onCurrentChange,onSizeChange:e.onSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])])),_:1}),C(v,{modelValue:e.edit_visible,"onUpdate:modelValue":l[0]||(l[0]=l=>e.edit_visible=l),center:"",title:e.posted.role.roleName},{default:w((()=>[C(g,{"current-role":e.posted,onSuccess:e.onEditSuccess},null,8,["current-role","onSuccess"])])),_:1},8,["modelValue","title"]),C(v,{modelValue:e.add_visible,"onUpdate:modelValue":l[1]||(l[1]=l=>e.add_visible=l),title:"新增角色"},{default:w((()=>[C(N,{onSuccess:e.onCreateSuccess},null,8,["onSuccess"])])),_:1},8,["modelValue"])])};export{L as default};
