System.register(["./rope-sequence-legacy.91e72191.js","./prosemirror-transform-legacy.b5eacd4e.js","./prosemirror-state-legacy.1039d02f.js"],(function(e){"use strict";var t,n,r,i;return{setters:[function(e){t=e.r},function(e){n=e.M},function(e){r=e.P,i=e.a}],execute:function(){e({a:function(e){var t=g.getState(e);return t?t.done.eventCount:0},h:function(e){return e={depth:e&&e.depth||100,newGroupDelay:e&&e.newGroupDelay||500},new i({key:g,state:{init:function(){return new o(s.empty,s.empty,null,0)},apply:function(t,n,r){return function(e,t,n,r){var i,a=n.getMeta(g);if(a)return a.historyState;n.getMeta(v)&&(e=new o(e.done,e.undone,null,0));var p=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(p&&p.getMeta(g))return p.getMeta(g).redo?new o(e.done.addTransform(n,null,r,f(t)),e.undone,u(n.mapping.maps[n.steps.length-1]),e.prevTime):new o(e.done,e.undone.addTransform(n,null,r,f(t)),null,e.prevTime);if(!1===n.getMeta("addToHistory")||p&&!1===p.getMeta("addToHistory"))return(i=n.getMeta("rebased"))?new o(e.done.rebased(n,i),e.undone.rebased(n,i),m(e.prevRanges,n.mapping),e.prevTime):new o(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),m(e.prevRanges,n.mapping),e.prevTime);var l=0==e.prevTime||!p&&(e.prevTime<(n.time||0)-r.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;var n=!1;return e.mapping.maps[0].forEach((function(e,r){for(var i=0;i<t.length;i+=2)e<=t[i+1]&&r>=t[i]&&(n=!0)})),n}(n,e.prevRanges)),h=p?m(e.prevRanges,n.mapping):u(n.mapping.maps[n.steps.length-1]);return new o(e.done.addTransform(n,l?t.selection.getBookmark():null,r,f(t)),s.empty,h,n.time)}(n,r,t,e)}},config:e})},r:function(e,t){var n=g.getState(e);return!(!n||0==n.undone.eventCount)&&(t&&l(n,e,t,!0),!0)},u:function(e,t){var n=g.getState(e);return!(!n||0==n.done.eventCount)&&(t&&l(n,e,t,!1),!0)}});var s=function(e,t){this.items=e,this.eventCount=t};s.prototype.popEvent=function(e,t){var n=this;if(0==this.eventCount)return null;for(var r,i,o=this.items.length;;o--)if(this.items.get(o-1).selection){--o;break}t&&(r=this.remapping(o,this.items.length),i=r.maps.length);var p,u,m=e.tr,l=[],h=[];return this.items.forEach((function(e,t){if(!e.step)return r||(r=n.remapping(o,t+1),i=r.maps.length),i--,void h.push(e);if(r){h.push(new a(e.map));var c,f=e.step.map(r.slice(i));f&&m.maybeStep(f).doc&&(c=m.mapping.maps[m.mapping.maps.length-1],l.push(new a(c,null,null,l.length+h.length))),i--,c&&r.appendMap(c,i)}else m.maybeStep(e.step);return e.selection?(p=r?e.selection.map(r.slice(i)):e.selection,u=new s(n.items.slice(0,o).append(h.reverse().concat(l)),n.eventCount-1),!1):void 0}),this.items.length,0),{remaining:u,transform:m,selection:p}},s.prototype.addTransform=function(e,t,n,r){for(var i=[],o=this.eventCount,u=this.items,m=!r&&u.length?u.get(u.length-1):null,l=0;l<e.steps.length;l++){var h,c=e.steps[l].invert(e.docs[l]),f=new a(e.mapping.maps[l],c,t);(h=m&&m.merge(f))&&(f=h,l?i.pop():u=u.slice(0,u.length-1)),i.push(f),t&&(o++,t=null),r||(m=f)}var g,v,d,y=o-n.depth;return y>p&&(v=y,(g=u).forEach((function(e,t){if(e.selection&&0==v--)return d=t,!1})),u=g.slice(d),o-=y),new s(u.append(i),o)},s.prototype.remapping=function(e,t){var r=new n;return this.items.forEach((function(t,n){var i=null!=t.mirrorOffset&&n-t.mirrorOffset>=e?r.maps.length-t.mirrorOffset:null;r.appendMap(t.map,i)}),e,t),r},s.prototype.addMaps=function(e){return 0==this.eventCount?this:new s(this.items.append(e.map((function(e){return new a(e)}))),this.eventCount)},s.prototype.rebased=function(e,t){if(!this.eventCount)return this;var n=[],r=Math.max(0,this.items.length-t),i=e.mapping,o=e.steps.length,p=this.eventCount;this.items.forEach((function(e){e.selection&&p--}),r);var u=t;this.items.forEach((function(t){var r=i.getMirror(--u);if(null!=r){o=Math.min(o,r);var s=i.maps[r];if(t.step){var m=e.steps[r].invert(e.docs[r]),l=t.selection&&t.selection.map(i.slice(u+1,r));l&&p++,n.push(new a(s,m,l))}else n.push(new a(s))}}),r);for(var m=[],l=t;l<o;l++)m.push(new a(i.maps[l]));var h=this.items.slice(0,r).append(m).append(n),c=new s(h,p);return c.emptyItemCount()>500&&(c=c.compress(this.items.length-n.length)),c},s.prototype.emptyItemCount=function(){var e=0;return this.items.forEach((function(t){t.step||e++})),e},s.prototype.compress=function(e){void 0===e&&(e=this.items.length);var n=this.remapping(0,e),r=n.maps.length,i=[],o=0;return this.items.forEach((function(t,s){if(s>=e)i.push(t),t.selection&&o++;else if(t.step){var p=t.step.map(n.slice(r)),u=p&&p.getMap();if(r--,u&&n.appendMap(u,r),p){var m=t.selection&&t.selection.map(n.slice(r));m&&o++;var l,h=new a(u.invert(),p,m),c=i.length-1;(l=i.length&&i[c].merge(h))?i[c]=l:i.push(h)}}else t.map&&r--}),this.items.length,0),new s(t.from(i.reverse()),o)},s.empty=new s(t.empty,0);var a=function(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r};a.prototype.merge=function(e){if(this.step&&e.step&&!e.selection){var t=e.step.merge(this.step);if(t)return new a(t.getMap().invert(),t,this.selection)}};var o=function(e,t,n,r){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r},p=20;function u(e){var t=[];return e.forEach((function(e,n,r,i){return t.push(r,i)})),t}function m(e,t){if(!e)return null;for(var n=[],r=0;r<e.length;r+=2){var i=t.map(e[r],1),s=t.map(e[r+1],-1);i<=s&&n.push(i,s)}return n}function l(e,t,n,r){var i=f(t),s=g.get(t).spec.config,a=(r?e.undone:e.done).popEvent(t,i);if(a){var p=a.selection.resolve(a.transform.doc),u=(r?e.done:e.undone).addTransform(a.transform,t.selection.getBookmark(),s,i),m=new o(r?u:a.remaining,r?a.remaining:u,null,0);n(a.transform.setSelection(p).setMeta(g,{redo:r,historyState:m}).scrollIntoView())}}var h=!1,c=null;function f(e){var t=e.plugins;if(c!=t){h=!1,c=t;for(var n=0;n<t.length;n++)if(t[n].spec.historyPreserveItems){h=!0;break}}return h}var g=new r("history"),v=new r("closeHistory")}}}));
