import{F as t,a as e,d as r,R as n}from"./prosemirror-model.475387bc.js";var o=Math.pow(2,16);function i(t){return 65535&t}var s=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=null),this.pos=t,this.deleted=e,this.recover=r},p=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};p.prototype.recover=function(t){var e=0,r=i(t);if(!this.inverted)for(var n=0;n<r;n++)e+=this.ranges[3*n+2]-this.ranges[3*n+1];return this.ranges[3*r]+e+function(t){return(t-(65535&t))/o}(t)},p.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},p.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},p.prototype._map=function(t,e,r){for(var n=0,i=this.inverted?2:1,p=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var h=this.ranges[a]-(this.inverted?n:0);if(h>t)break;var c=this.ranges[a+i],f=this.ranges[a+p],u=h+c;if(t<=u){var l=h+n+((c?t==h?-1:t==u?1:e:e)<0?0:f);if(r)return l;var d=t==(e<0?h:u)?null:a/3+(t-h)*o;return new s(l,e<0?t!=h:t!=u,d)}n+=f-c}return r?t+n:new s(t+n)},p.prototype.touches=function(t,e){for(var r=0,n=i(e),o=this.inverted?2:1,s=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var a=this.ranges[p]-(this.inverted?r:0);if(a>t)break;var h=this.ranges[p+o];if(t<=a+h&&p==3*n)return!0;r+=this.ranges[p+s]-h}return!1},p.prototype.forEach=function(t){for(var e=this.inverted?2:1,r=this.inverted?1:2,n=0,o=0;n<this.ranges.length;n+=3){var i=this.ranges[n],s=i-(this.inverted?o:0),p=i+(this.inverted?0:o),a=this.ranges[n+e],h=this.ranges[n+r];t(s,s+a,p,p+h),o+=h-a}},p.prototype.invert=function(){return new p(this.ranges,!this.inverted)},p.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},p.offset=function(t){return 0==t?p.empty:new p(t<0?[0,-t,0]:[0,0,t])},p.empty=new p([]);var a=function(t,e,r,n){this.maps=t||[],this.from=r||0,this.to=null==n?this.maps.length:n,this.mirror=e};function h(t){var e=Error.call(this,t);return e.__proto__=h.prototype,e}a.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new a(this.maps,this.mirror,t,e)},a.prototype.copy=function(){return new a(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},a.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},a.prototype.appendMapping=function(t){for(var e=0,r=this.maps.length;e<t.maps.length;e++){var n=t.getMirror(e);this.appendMap(t.maps[e],null!=n&&n<e?r+n:null)}},a.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},a.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},a.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){var n=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=n&&n>e?r-n-1:null)}},a.prototype.invert=function(){var t=new a;return t.appendMappingInverted(this),t},a.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t},a.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},a.prototype._map=function(t,e,r){for(var n=!1,o=this.from;o<this.to;o++){var i=this.maps[o].mapResult(t,e);if(null!=i.recover){var p=this.getMirror(o);if(null!=p&&p>o&&p<this.to){o=p,t=this.maps[p].recover(i.recover);continue}}i.deleted&&(n=!0),t=i.pos}return r?t:new s(t,n)},h.prototype=Object.create(Error.prototype),h.prototype.constructor=h,h.prototype.name="TransformError";var c=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new a},f={before:{configurable:!0},docChanged:{configurable:!0}};function u(){throw new Error("Override me")}f.before.get=function(){return this.docs.length?this.docs[0]:this.doc},c.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new h(e.failed);return this},c.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},f.docChanged.get=function(){return this.steps.length>0},c.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(c.prototype,f);var l=Object.create(null),d=function(){};d.prototype.apply=function(t){return u()},d.prototype.getMap=function(){return p.empty},d.prototype.invert=function(t){return u()},d.prototype.map=function(t){return u()},d.prototype.merge=function(t){return null},d.prototype.toJSON=function(){return u()},d.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=l[e.stepType];if(!r)throw new RangeError("No step type "+e.stepType+" defined");return r.fromJSON(t,e)},d.jsonID=function(t,e){if(t in l)throw new RangeError("Duplicate use of step JSON ID "+t);return l[t]=e,e.prototype.jsonID=t,e};var m=function(t,e){this.doc=t,this.failed=e};m.ok=function(t){return new m(t,null)},m.fail=function(t){return new m(null,t)},m.fromReplace=function(t,e,r,o){try{return m.ok(t.replace(e,r,o))}catch(i){if(i instanceof n)return m.fail(i.message);throw i}};var v=function(t){function r(e,r,n,o){t.call(this),this.from=e,this.to=r,this.slice=n,this.structure=!!o}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.apply=function(t){return this.structure&&g(t,this.from,this.to)?m.fail("Structure replace would overwrite content"):m.fromReplace(t,this.from,this.to,this.slice)},r.prototype.getMap=function(){return new p([this.from,this.to-this.from,this.slice.size])},r.prototype.invert=function(t){return new r(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},r.prototype.map=function(t){var e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted?null:new r(e.pos,Math.max(e.pos,n.pos),this.slice)},r.prototype.merge=function(t){if(!(t instanceof r)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?e.empty:new e(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new r(t.from,this.to,n,this.structure)}var o=this.slice.size+t.slice.size==0?e.empty:new e(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new r(this.from,this.to+(t.to-t.from),o,this.structure)},r.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},r.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new r(n.from,n.to,e.fromJSON(t,n.slice),!!n.structure)},r}(d);d.jsonID("replace",v);var y=function(t){function r(e,r,n,o,i,s,p){t.call(this),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!p}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.apply=function(t){if(this.structure&&(g(t,this.from,this.gapFrom)||g(t,this.gapTo,this.to)))return m.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return m.fail("Gap is not a flat range");var r=this.slice.insertAt(this.insert,e.content);return r?m.fromReplace(t,this.from,this.to,r):m.fail("Content does not fit in gap")},r.prototype.getMap=function(){return new p([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},r.prototype.invert=function(t){var e=this.gapTo-this.gapFrom;return new r(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},r.prototype.map=function(t){var e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return e.deleted&&n.deleted||o<e.pos||i>n.pos?null:new r(e.pos,n.pos,o,i,this.slice,this.insert,this.structure)},r.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},r.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new r(n.from,n.to,n.gapFrom,n.gapTo,e.fromJSON(t,n.slice),n.insert,!!n.structure)},r}(d);function g(t,e,r){for(var n=t.resolve(e),o=r-e,i=n.depth;o>0&&i>0&&n.indexAfter(i)==n.node(i).childCount;)i--,o--;if(o>0)for(var s=n.node(i).maybeChild(n.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function w(t,e,r){return(0==e||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function k(t){for(var e=t.parent.content.cutByIndex(t.startIndex,t.endIndex),r=t.depth;;--r){var n=t.$from.node(r),o=t.$from.index(r),i=t.$to.indexAfter(r);if(r<t.depth&&n.canReplace(o,i,e))return r;if(0==r||n.type.spec.isolating||!w(n,o,i))break}}function S(t,e,r,n){void 0===n&&(n=t);var o=function(t,e){var r=t.parent,n=t.startIndex,o=t.endIndex,i=r.contentMatchAt(n).findWrapping(e);if(!i)return null;var s=i.length?i[0]:e;return r.canReplaceWith(n,o,s)?i:null}(t,e),i=o&&function(t,e){var r=t.parent,n=t.startIndex,o=t.endIndex,i=r.child(n),s=e.contentMatch.findWrapping(i.type);if(!s)return null;for(var p=(s.length?s[s.length-1]:e).contentMatch,a=n;p&&a<o;a++)p=p.matchType(r.child(a).type);if(!p||!p.validEnd)return null;return s}(n,e);return i?o.map(M).concat({type:e,attrs:r}).concat(i.map(M)):null}function M(t){return{type:t,attrs:null}}function b(t,e,r,n){void 0===r&&(r=1);var o=t.resolve(e),i=o.depth-r,s=n&&n[n.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var p=o.depth-1,a=r-2;p>i;p--,a--){var h=o.node(p),c=o.index(p);if(h.type.spec.isolating)return!1;var f=h.content.cutByIndex(c,h.childCount),u=n&&n[a]||h;if(u!=h&&(f=f.replaceChild(0,u.type.create(u.attrs))),!h.canReplace(c+1,h.childCount)||!u.type.validContent(f))return!1}var l=o.indexAfter(i),d=n&&n[0];return o.node(i).canReplaceWith(l,l,d?d.type:o.node(i+1).type)}function C(t,e){var r,n,o=t.resolve(e),i=o.index();return r=o.nodeBefore,n=o.nodeAfter,r&&n&&!r.isLeaf&&r.canAppend(n)&&o.parent.canReplace(i,i+1)}function R(t,e,r){var n=t.resolve(e);if(!r.content.size)return e;for(var o=r.content,i=0;i<r.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(0==r.openStart&&r.size?2:1);s++)for(var p=n.depth;p>=0;p--){var a=p==n.depth?0:n.pos<=(n.start(p+1)+n.end(p+1))/2?-1:1,h=n.index(p)+(a>0?1:0),c=n.node(p),f=!1;if(1==s)f=c.canReplace(h,h,o);else{var u=c.contentMatchAt(h).findWrapping(o.firstChild.type);f=u&&c.canReplaceWith(h,h,u[0])}if(f)return 0==a?n.pos:a<0?n.before(p+1):n.after(p+1)}return null}function x(e,r,n){for(var o=[],i=0;i<e.childCount;i++){var s=e.child(i);s.content.size&&(s=s.copy(x(s.content,r,s))),s.isInline&&(s=r(s,n,i)),o.push(s)}return t.fromArray(o)}d.jsonID("replaceAround",y),c.prototype.lift=function(r,n){for(var o=r.$from,i=r.$to,s=r.depth,p=o.before(s+1),a=i.after(s+1),h=p,c=a,f=t.empty,u=0,l=s,d=!1;l>n;l--)d||o.index(l)>0?(d=!0,f=t.from(o.node(l).copy(f)),u++):h--;for(var m=t.empty,v=0,g=s,w=!1;g>n;g--)w||i.after(g+1)<i.end(g)?(w=!0,m=t.from(i.node(g).copy(m)),v++):c++;return this.step(new y(h,c,p,a,new e(f.append(m),u,v),f.size-u,!0))},c.prototype.wrap=function(r,n){for(var o=t.empty,i=n.length-1;i>=0;i--)o=t.from(n[i].type.create(n[i].attrs,o));var s=r.start,p=r.end;return this.step(new y(s,p,s,p,new e(o,0,0),n.length,!0))},c.prototype.setBlockType=function(r,n,o,i){var s=this;if(void 0===n&&(n=r),!o.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var p=this.steps.length;return this.doc.nodesBetween(r,n,(function(r,n){if(r.isTextblock&&!r.hasMarkup(o,i)&&function(t,e,r){var n=t.resolve(e),o=n.index();return n.parent.canReplaceWith(o,o+1,r)}(s.doc,s.mapping.slice(p).map(n),o)){s.clearIncompatible(s.mapping.slice(p).map(n,1),o);var a=s.mapping.slice(p),h=a.map(n,1),c=a.map(n+r.nodeSize,1);return s.step(new y(h,c,h+1,c-1,new e(t.from(o.create(i,null,r.marks)),0,0),1,!0)),!1}})),this},c.prototype.setNodeMarkup=function(r,n,o,i){var s=this.doc.nodeAt(r);if(!s)throw new RangeError("No node at given position");n||(n=s.type);var p=n.create(o,null,i||s.marks);if(s.isLeaf)return this.replaceWith(r,r+s.nodeSize,p);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);return this.step(new y(r,r+s.nodeSize,r+1,r+s.nodeSize-1,new e(t.from(p),0,0),1,!0))},c.prototype.split=function(r,n,o){void 0===n&&(n=1);for(var i=this.doc.resolve(r),s=t.empty,p=t.empty,a=i.depth,h=i.depth-n,c=n-1;a>h;a--,c--){s=t.from(i.node(a).copy(s));var f=o&&o[c];p=t.from(f?f.type.create(f.attrs,p):i.node(a).copy(p))}return this.step(new v(r,r,new e(s.append(p),n,n),!0))},c.prototype.join=function(t,r){void 0===r&&(r=1);var n=new v(t-r,t+r,e.empty,!0);return this.step(n)};var N=function(t){function r(e,r,n){t.call(this),this.from=e,this.to=r,this.mark=n}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.apply=function(t){var r=this,n=t.slice(this.from,this.to),o=t.resolve(this.from),i=o.node(o.sharedDepth(this.to)),s=new e(x(n.content,(function(t,e){return t.isAtom&&e.type.allowsMarkType(r.mark.type)?t.mark(r.mark.addToSet(t.marks)):t}),i),n.openStart,n.openEnd);return m.fromReplace(t,this.from,this.to,s)},r.prototype.invert=function(){return new T(this.from,this.to,this.mark)},r.prototype.map=function(t){var e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new r(e.pos,n.pos,this.mark)},r.prototype.merge=function(t){if(t instanceof r&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new r(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},r.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},r.fromJSON=function(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new r(e.from,e.to,t.markFromJSON(e.mark))},r}(d);d.jsonID("addMark",N);var T=function(t){function r(e,r,n){t.call(this),this.from=e,this.to=r,this.mark=n}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.apply=function(t){var r=this,n=t.slice(this.from,this.to),o=new e(x(n.content,(function(t){return t.mark(r.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return m.fromReplace(t,this.from,this.to,o)},r.prototype.invert=function(){return new N(this.from,this.to,this.mark)},r.prototype.map=function(t){var e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new r(e.pos,n.pos,this.mark)},r.prototype.merge=function(t){if(t instanceof r&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new r(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},r.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},r.fromJSON=function(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new r(e.from,e.to,t.markFromJSON(e.mark))},r}(d);function O(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}d.jsonID("removeMark",T),c.prototype.addMark=function(t,e,r){var n=this,o=[],i=[],s=null,p=null;return this.doc.nodesBetween(t,e,(function(n,a,h){if(n.isInline){var c=n.marks;if(!r.isInSet(c)&&h.type.allowsMarkType(r.type)){for(var f=Math.max(a,t),u=Math.min(a+n.nodeSize,e),l=r.addToSet(c),d=0;d<c.length;d++)c[d].isInSet(l)||(s&&s.to==f&&s.mark.eq(c[d])?s.to=u:o.push(s=new T(f,u,c[d])));p&&p.to==f?p.to=u:i.push(p=new N(f,u,r))}}})),o.forEach((function(t){return n.step(t)})),i.forEach((function(t){return n.step(t)})),this},c.prototype.removeMark=function(t,e,n){var o=this;void 0===n&&(n=null);var i=[],s=0;return this.doc.nodesBetween(t,e,(function(o,p){if(o.isInline){s++;var a=null;if(n instanceof r)for(var h,c=o.marks;h=n.isInSet(c);)(a||(a=[])).push(h),c=h.removeFromSet(c);else n?n.isInSet(o.marks)&&(a=[n]):a=o.marks;if(a&&a.length)for(var f=Math.min(p+o.nodeSize,e),u=0;u<a.length;u++){for(var l=a[u],d=void 0,m=0;m<i.length;m++){var v=i[m];v.step==s-1&&l.eq(i[m].style)&&(d=v)}d?(d.to=f,d.step=s):i.push({style:l,from:Math.max(p,t),to:f,step:s})}}})),i.forEach((function(t){return o.step(new T(t.from,t.to,t.style))})),this},c.prototype.clearIncompatible=function(r,n,o){void 0===o&&(o=n.contentMatch);for(var i=this.doc.nodeAt(r),s=[],p=r+1,a=0;a<i.childCount;a++){var h=i.child(a),c=p+h.nodeSize,f=o.matchType(h.type,h.attrs);if(f){o=f;for(var u=0;u<h.marks.length;u++)n.allowsMarkType(h.marks[u].type)||this.step(new T(p,c,h.marks[u]))}else s.push(new v(p,c,e.empty));p=c}if(!o.validEnd){var l=o.fillBefore(t.empty,!0);this.replace(p,p,new e(l,0,0))}for(var d=s.length-1;d>=0;d--)this.step(s[d]);return this},c.prototype.replace=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=e.empty);var o=function(t,r,n,o){if(void 0===n&&(n=r),void 0===o&&(o=e.empty),r==n&&!o.size)return null;var i=t.resolve(r),s=t.resolve(n);return O(i,s,o)?new v(r,n,o):new I(i,s,o).fit()}(this.doc,t,r,n);return o&&this.step(o),this},c.prototype.replaceWith=function(r,n,o){return this.replace(r,n,new e(t.from(o),0,0))},c.prototype.delete=function(t,r){return this.replace(t,r,e.empty)},c.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var I=function(e,r,n){this.$to=r,this.$from=e,this.unplaced=n,this.frontier=[];for(var o=0;o<=e.depth;o++){var i=e.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(o))})}this.placed=t.empty;for(var s=e.depth;s>0;s--)this.placed=t.from(e.node(s).copy(this.placed))},z={depth:{configurable:!0}};function E(t,e,r){return 0==e?t.cutByIndex(r):t.replaceChild(0,t.firstChild.copy(E(t.firstChild.content,e-1,r)))}function F(t,e,r){return 0==e?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(F(t.lastChild.content,e-1,r)))}function J(t,e){for(var r=0;r<e;r++)t=t.firstChild.content;return t}function _(e,r,n){if(r<=0)return e;var o=e.content;return r>1&&(o=o.replaceChild(0,_(o.firstChild,r-1,1==o.childCount?n-1:0))),r>0&&(o=e.type.contentMatch.fillBefore(o).append(o),n<=0&&(o=o.append(e.type.contentMatch.matchFragment(o).fillBefore(t.empty,!0)))),e.copy(o)}function A(t,e,r,n,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!r.compatibleContent(i.type))return null;var p=n.fillBefore(i.content,!0,s);return p&&!function(t,e,r){for(var n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}(r,i.content,s)?p:null}function $(e,r,n,o,i){if(r<n){var s=e.firstChild;e=e.replaceChild(0,s.copy($(s.content,r+1,n,o,s)))}if(r>o){var p=i.contentMatchAt(0),a=p.fillBefore(e).append(e);e=a.append(p.matchFragment(a).fillBefore(t.empty,!0))}return e}function B(t,e){for(var r=[],n=Math.min(t.depth,e.depth);n>=0;n--){var o=t.start(n);if(o<t.pos-(t.depth-n)||e.end(n)>e.pos+(e.depth-n)||t.node(n).type.spec.isolating||e.node(n).type.spec.isolating)break;o==e.start(n)&&r.push(n)}return r}z.depth.get=function(){return this.frontier.length-1},I.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var r=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,o=this.$from,i=this.close(r<0?this.$to:o.doc.resolve(r));if(!i)return null;for(var s=this.placed,p=o.depth,a=i.depth;p&&a&&1==s.childCount;)s=s.firstChild.content,p--,a--;var h=new e(s,p,a);return r>-1?new y(o.pos,r,this.$to.pos,this.$to.end(),h,n):h.size||o.pos!=this.$to.pos?new v(o.pos,i.pos,h):void 0},I.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var r=this.unplaced.openStart;r>=0;r--)for(var n=void 0,o=(r?(n=J(this.unplaced.content,r-1).firstChild).content:this.unplaced.content).firstChild,i=this.depth;i>=0;i--){var s=this.frontier[i],p=s.type,a=s.match,h=void 0,c=void 0;if(1==e&&(o?a.matchType(o.type)||(c=a.fillBefore(t.from(o),!1)):p.compatibleContent(n.type)))return{sliceDepth:r,frontierDepth:i,parent:n,inject:c};if(2==e&&o&&(h=a.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:i,parent:n,wrap:h};if(n&&a.matchType(n.type))break}},I.prototype.openMore=function(){var t=this.unplaced,r=t.content,n=t.openStart,o=t.openEnd,i=J(r,n);return!(!i.childCount||i.firstChild.isLeaf)&&(this.unplaced=new e(r,n+1,Math.max(o,i.size+n>=r.size-o?n+1:0)),!0)},I.prototype.dropNode=function(){var t=this.unplaced,r=t.content,n=t.openStart,o=t.openEnd,i=J(r,n);if(i.childCount<=1&&n>0){var s=r.size-n<=n+i.size;this.unplaced=new e(E(r,n-1,1),n-1,s?n-1:o)}else this.unplaced=new e(E(r,n,1),n,o)},I.prototype.placeNodes=function(r){for(var n=r.sliceDepth,o=r.frontierDepth,i=r.parent,s=r.inject,p=r.wrap;this.depth>o;)this.closeFrontierNode();if(p)for(var a=0;a<p.length;a++)this.openFrontierNode(p[a]);var h=this.unplaced,c=i?i.content:h.content,f=h.openStart-n,u=0,l=[],d=this.frontier[o],m=d.match,v=d.type;if(s){for(var y=0;y<s.childCount;y++)l.push(s.child(y));m=m.matchFragment(s)}for(var g=c.size+n-(h.content.size-h.openEnd);u<c.childCount;){var w=c.child(u),k=m.matchType(w.type);if(!k)break;(++u>1||0==f||w.content.size)&&(m=k,l.push(_(w.mark(v.allowedMarks(w.marks)),1==u?f:0,u==c.childCount?g:-1)))}var S=u==c.childCount;S||(g=-1),this.placed=F(this.placed,o,t.from(l)),this.frontier[o].match=m,S&&g<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var M=0,b=c;M<g;M++){var C=b.lastChild;this.frontier.push({type:C.type,match:C.contentMatchAt(C.childCount)}),b=C.content}this.unplaced=S?0==n?e.empty:new e(E(h.content,n-1,1),n-1,g<0?h.openEnd:n-1):new e(E(h.content,n,u),h.openStart,h.openEnd)},I.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!A(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var r=this.$to.depth,n=this.$to.after(r);r>1&&n==this.$to.end(--r);)++n;return n},I.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var r=this.frontier[e],n=r.match,o=r.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=A(t,e,o,n,i);if(s){for(var p=e-1;p>=0;p--){var a=this.frontier[p],h=a.match,c=A(t,p,a.type,h,!0);if(!c||c.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},I.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=F(this.placed,e.depth,e.fit)),t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var n=t.node(r),o=n.type.contentMatch.fillBefore(n.content,!0,t.index(r));this.openFrontierNode(n.type,n.attrs,o)}return t},I.prototype.openFrontierNode=function(e,r,n){var o=this.frontier[this.depth];o.match=o.match.matchType(e),this.placed=F(this.placed,this.depth,t.from(e.create(r,n))),this.frontier.push({type:e,match:e.contentMatch})},I.prototype.closeFrontierNode=function(){var e=this.frontier.pop().match.fillBefore(t.empty,!0);e.childCount&&(this.placed=F(this.placed,this.frontier.length,e))},Object.defineProperties(I.prototype,z),c.prototype.replaceRange=function(t,r,n){if(!n.size)return this.deleteRange(t,r);var o=this.doc.resolve(t),i=this.doc.resolve(r);if(O(o,i,n))return this.step(new v(t,r,n));var s=B(o,this.doc.resolve(r));0==s[s.length-1]&&s.pop();var p=-(o.depth+1);s.unshift(p);for(var a=o.depth,h=o.pos-1;a>0;a--,h--){var c=o.node(a).type.spec;if(c.defining||c.isolating)break;s.indexOf(a)>-1?p=a:o.before(a)==h&&s.splice(1,0,-a)}for(var f=s.indexOf(p),u=[],l=n.openStart,d=n.content,m=0;;m++){var y=d.firstChild;if(u.push(y),m==n.openStart)break;d=y.content}l>0&&u[l-1].type.spec.defining&&o.node(f).type!=u[l-1].type?l-=1:l>=2&&u[l-1].isTextblock&&u[l-2].type.spec.defining&&o.node(f).type!=u[l-2].type&&(l-=2);for(var g=n.openStart;g>=0;g--){var w=(g+l+1)%(n.openStart+1),k=u[w];if(k)for(var S=0;S<s.length;S++){var M=s[(S+f)%s.length],b=!0;M<0&&(b=!1,M=-M);var C=o.node(M-1),R=o.index(M-1);if(C.canReplaceWith(R,R,k.type,k.marks))return this.replace(o.before(M),b?i.after(M):r,new e($(n.content,0,n.openStart,w),w,n.openEnd))}}for(var x=this.steps.length,N=s.length-1;N>=0&&(this.replace(t,r,n),!(this.steps.length>x));N--){var T=s[N];T<0||(t=o.before(T),r=i.after(T))}return this},c.prototype.replaceRangeWith=function(r,n,o){if(!o.isInline&&r==n&&this.doc.resolve(r).parent.content.size){var i=function(t,e,r){var n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(0==n.parentOffset)for(var o=n.depth-1;o>=0;o--){var i=n.index(o);if(n.node(o).canReplaceWith(i,i,r))return n.before(o+1);if(i>0)return null}if(n.parentOffset==n.parent.content.size)for(var s=n.depth-1;s>=0;s--){var p=n.indexAfter(s);if(n.node(s).canReplaceWith(p,p,r))return n.after(s+1);if(p<n.node(s).childCount)return null}}(this.doc,r,o.type);null!=i&&(r=n=i)}return this.replaceRange(r,n,new e(t.from(o),0,0))},c.prototype.deleteRange=function(t,e){for(var r=this.doc.resolve(t),n=this.doc.resolve(e),o=B(r,n),i=0;i<o.length;i++){var s=o[i],p=i==o.length-1;if(p&&0==s||r.node(s).type.contentMatch.validEnd)return this.delete(r.start(s),n.end(s));if(s>0&&(p||r.node(s-1).canReplace(r.index(s-1),n.indexAfter(s-1))))return this.delete(r.before(s),n.after(s))}for(var a=1;a<=r.depth&&a<=n.depth;a++)if(t-r.start(a)==r.depth-a&&e>r.end(a)&&n.end(a)-e!=n.depth-a)return this.delete(r.before(a),e);return this.delete(t,e)};export{a as M,y as R,p as S,c as T,v as a,C as b,b as c,R as d,S as f,k as l};
