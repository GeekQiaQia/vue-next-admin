import{f as e,l as t,c as r,R as n,b as o}from"./prosemirror-transform.de62111a.js";import{F as i,a}from"./prosemirror-model.475387bc.js";import{S as s,A as c,N as l,T as p}from"./prosemirror-state.1b80bdaa.js";function f(e,t){return!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0)}function d(e,t){for(;e;e="start"==t?e.firstChild:e.lastChild)if(e.isTextblock)return!0;return!1}function u(e){if(!e.parent.type.spec.isolating)for(var t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function v(e,t,r){var n=e.selection.$cursor;if(!n||(r?!r.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size))return!1;var o=m(n);if(!o)return!1;var i=o.nodeAfter;if(b(e,o,t))return!0;if(0==n.parent.content.size&&(d(i,"start")||l.isSelectable(i))){if(t){var a=e.tr.deleteRange(n.before(),n.after());a.setSelection(d(i,"start")?s.findFrom(a.doc.resolve(a.mapping.map(o.pos)),1):l.create(a.doc,a.mapping.map(o.pos))),t(a.scrollIntoView())}return!0}return!(!i.isAtom||o.depth!=n.depth-1)&&(t&&t(e.tr.delete(o.pos,o.pos+i.nodeSize).scrollIntoView()),!0)}function m(e){if(!e.parent.type.spec.isolating)for(var t=e.depth-1;t>=0;t--){var r=e.node(t);if(e.index(t)+1<r.childCount)return e.doc.resolve(e.after(t+1));if(r.type.spec.isolating)break}return null}function h(e,t){var r=e.selection,n=r.$head,o=r.$anchor;return!(!n.parent.type.spec.code||!n.sameParent(o))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)}function g(e){for(var t=0;t<e.edgeCount;t++){var r=e.edge(t).type;if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function k(e,t){var r=e.selection,n=r.$head,o=r.$anchor;if(!n.parent.type.spec.code||!n.sameParent(o))return!1;var i=n.node(-1),a=n.indexAfter(-1),c=g(i.contentMatchAt(a));if(!i.canReplaceWith(a,a,c))return!1;if(t){var l=n.after(),p=e.tr.replaceWith(l,l,c.createAndFill());p.setSelection(s.near(p.doc.resolve(l),1)),t(p.scrollIntoView())}return!0}function w(e,t){return t&&t(e.tr.setSelection(new c(e.doc))),!0}function b(e,r,c){var l,p,f=r.nodeBefore,u=r.nodeAfter;if(f.type.spec.isolating||u.type.spec.isolating)return!1;if(function(e,t,r){var n=t.nodeBefore,i=t.nodeAfter,a=t.index();return!(!(n&&i&&n.type.compatibleContent(i.type))||(!n.content.size&&t.parent.canReplace(a-1,a)?(r&&r(e.tr.delete(t.pos-n.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(a,a+1)||!i.isTextblock&&!o(e.doc,t.pos)||(r&&r(e.tr.clearIncompatible(t.pos,n.type,n.contentMatchAt(n.childCount)).join(t.pos).scrollIntoView()),0)))}(e,r,c))return!0;var v=r.parent.canReplace(r.index(),r.index()+1);if(v&&(l=(p=f.contentMatchAt(f.childCount)).findWrapping(u.type))&&p.matchType(l[0]||u.type).validEnd){if(c){for(var m=r.pos+u.nodeSize,h=i.empty,g=l.length-1;g>=0;g--)h=i.from(l[g].create(null,h));h=i.from(f.copy(h));var k=e.tr.step(new n(r.pos-1,m,r.pos,m,new a(h,1,0),l.length,!0)),w=m+2*l.length;o(k.doc,w)&&k.join(w),c(k.scrollIntoView())}return!0}var b=s.findFrom(r,1),y=b&&b.$from.blockRange(b.$to),x=y&&t(y);if(null!=x&&x>=r.depth)return c&&c(e.tr.lift(y,x).scrollIntoView()),!0;if(v&&u.isTextblock&&d(f,"end")){for(var I=f,S=[];S.push(I),!I.isTextblock;)I=I.lastChild;if(I.canReplace(I.childCount,I.childCount,u.content)){if(c){for(var $=i.empty,M=S.length-1;M>=0;M--)$=i.from(S[M].copy($));c(e.tr.step(new n(r.pos-S.length,r.pos+u.nodeSize,r.pos+1,r.pos+u.nodeSize-1,new a($,S.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function y(t,r){return function(n,o){var i=n.selection,a=i.$from,s=i.$to,c=a.blockRange(s),l=c&&e(c,t,r);return!!l&&(o&&o(n.tr.wrap(c,l).scrollIntoView()),!0)}}function x(e,t){return function(r,n){var o=r.selection,i=o.from,a=o.to,s=!1;return r.doc.nodesBetween(i,a,(function(n,o){if(s)return!1;if(n.isTextblock&&!n.hasMarkup(e,t))if(n.type==e)s=!0;else{var i=r.doc.resolve(o),a=i.index();s=i.parent.canReplaceWith(a,a+1,e)}})),!!s&&(n&&n(r.tr.setBlockType(i,a,e,t).scrollIntoView()),!0)}}function I(e,t){return function(r,n){var o=r.selection,i=o.empty,a=o.$cursor,s=o.ranges;if(i&&!a||!function(e,t,r){for(var n=function(n){var o=t[n],i=o.$from,a=o.$to,s=0==i.depth&&e.type.allowsMarkType(r);if(e.nodesBetween(i.pos,a.pos,(function(e){if(s)return!1;s=e.inlineContent&&e.type.allowsMarkType(r)})),s)return{v:!0}},o=0;o<t.length;o++){var i=n(o);if(i)return i.v}return!1}(r.doc,s,e))return!1;if(n)if(a)e.isInSet(r.storedMarks||a.marks())?n(r.tr.removeStoredMark(e)):n(r.tr.addStoredMark(e.create(t)));else{for(var c=!1,l=r.tr,p=0;!c&&p<s.length;p++){var f=s[p],d=f.$from,u=f.$to;c=r.doc.rangeHasMark(d.pos,u.pos,e)}for(var v=0;v<s.length;v++){var m=s[v],h=m.$from,g=m.$to;if(c)l.removeMark(h.pos,g.pos,e);else{var k=h.pos,w=g.pos,b=h.nodeAfter,y=g.nodeBefore,x=b&&b.isText?/^\s*/.exec(b.text)[0].length:0,I=y&&y.isText?/\s*$/.exec(y.text)[0].length:0;k+x<w&&(k+=x,w-=I),l.addMark(k,w,e.create(t))}}n(l.scrollIntoView())}return!0}}function S(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return function(t,r,n){for(var o=0;o<e.length;o++)if(e[o](t,r,n))return!0;return!1}}var $=S(f,(function(e,r,n){var o=e.selection.$cursor;if(!o||(n?!n.endOfTextblock("backward",e):o.parentOffset>0))return!1;var i=u(o);if(!i){var a=o.blockRange(),c=a&&t(a);return null!=c&&(r&&r(e.tr.lift(a,c).scrollIntoView()),!0)}var p=i.nodeBefore;if(!p.type.spec.isolating&&b(e,i,r))return!0;if(0==o.parent.content.size&&(d(p,"end")||l.isSelectable(p))){if(r){var f=e.tr.deleteRange(o.before(),o.after());f.setSelection(d(p,"end")?s.findFrom(f.doc.resolve(f.mapping.map(i.pos,-1)),-1):l.create(f.doc,i.pos-p.nodeSize)),r(f.scrollIntoView())}return!0}return!(!p.isAtom||i.depth!=o.depth-1)&&(r&&r(e.tr.delete(i.pos-p.nodeSize,i.pos).scrollIntoView()),!0)}),(function(e,t,r){var n=e.selection,o=n.$head,i=o;if(!n.empty)return!1;if(o.parent.isTextblock){if(r?!r.endOfTextblock("backward",e):o.parentOffset>0)return!1;i=u(o)}var a=i&&i.nodeBefore;return!(!a||!l.isSelectable(a))&&(t&&t(e.tr.setSelection(l.create(e.doc,i.pos-a.nodeSize)).scrollIntoView()),!0)})),M=S(f,v,(function(e,t,r){var n=e.selection,o=n.$head,i=o;if(!n.empty)return!1;if(o.parent.isTextblock){if(r?!r.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size)return!1;i=m(o)}var a=i&&i.nodeAfter;return!(!a||!l.isSelectable(a))&&(t&&t(e.tr.setSelection(l.create(e.doc,i.pos)).scrollIntoView()),!0)})),A={Enter:S(h,(function(e,t){var r=e.selection,n=r.$from,o=r.$to;if(r instanceof c||n.parent.inlineContent||o.parent.inlineContent)return!1;var i=g(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(t){var a=(!n.parentOffset&&o.index()<o.parent.childCount?n:o).pos,s=e.tr.insert(a,i.createAndFill());s.setSelection(p.create(s.doc,a+1)),t(s.scrollIntoView())}return!0}),(function(e,n){var o=e.selection.$cursor;if(!o||o.parent.content.size)return!1;if(o.depth>1&&o.after()!=o.end(-1)){var i=o.before();if(r(e.doc,i))return n&&n(e.tr.split(i).scrollIntoView()),!0}var a=o.blockRange(),s=a&&t(a);return null!=s&&(n&&n(e.tr.lift(a,s).scrollIntoView()),!0)}),(function(e,t){var n=e.selection,o=n.$from,i=n.$to;if(e.selection instanceof l&&e.selection.node.isBlock)return!(!o.parentOffset||!r(e.doc,o.pos))&&(t&&t(e.tr.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;if(t){var a=i.parentOffset==i.parent.content.size,s=e.tr;(e.selection instanceof p||e.selection instanceof c)&&s.deleteSelection();var f=0==o.depth?null:g(o.node(-1).contentMatchAt(o.indexAfter(-1))),d=a&&f?[{type:f}]:null,u=r(s.doc,s.mapping.map(o.pos),1,d);if(d||u||!r(s.doc,s.mapping.map(o.pos),1,f&&[{type:f}])||(d=[{type:f}],u=!0),u&&(s.split(s.mapping.map(o.pos),1,d),!a&&!o.parentOffset&&o.parent.type!=f)){var v=s.mapping.map(o.before()),m=s.doc.resolve(v);o.node(-1).canReplaceWith(m.index(),m.index()+1,f)&&s.setNodeMarkup(s.mapping.map(o.before()),f)}t(s.scrollIntoView())}return!0})),"Mod-Enter":k,Backspace:$,"Mod-Backspace":$,Delete:M,"Mod-Delete":M,"Mod-a":w},V={"Ctrl-h":A.Backspace,"Alt-Backspace":A["Mod-Backspace"],"Ctrl-d":A.Delete,"Ctrl-Alt-Backspace":A["Mod-Delete"],"Alt-Delete":A["Mod-Delete"],"Alt-d":A["Mod-Delete"]};for(var T in A)V[T]=A[T];var C=("undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os&&"darwin"==os.platform())?V:A;export{w as a,C as b,S as c,f as d,k as e,v as j,h as n,x as s,I as t,y as w};
