System.register(["./prosemirror-model-legacy.4a10d9e7.js"],(function(t){"use strict";var e,r,n,o;return{setters:[function(t){e=t.F,r=t.a,n=t.d,o=t.R}],execute:function(){t({b:function(t,e){var r,n,o=t.resolve(e),i=o.index();return r=o.nodeBefore,n=o.nodeAfter,r&&n&&!r.isLeaf&&r.canAppend(n)&&o.parent.canReplace(i,i+1)},c:function(t,e,r,n){void 0===r&&(r=1);var o=t.resolve(e),i=o.depth-r,s=n&&n[n.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var p=o.depth-1,a=r-2;p>i;p--,a--){var h=o.node(p),c=o.index(p);if(h.type.spec.isolating)return!1;var f=h.content.cutByIndex(c,h.childCount),u=n&&n[a]||h;if(u!=h&&(f=f.replaceChild(0,u.type.create(u.attrs))),!h.canReplace(c+1,h.childCount)||!u.type.validContent(f))return!1}var l=o.indexAfter(i),d=n&&n[0];return o.node(i).canReplaceWith(l,l,d?d.type:o.node(i+1).type)},d:function(t,e,r){var n=t.resolve(e);if(!r.content.size)return e;for(var o=r.content,i=0;i<r.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(0==r.openStart&&r.size?2:1);s++)for(var p=n.depth;p>=0;p--){var a=p==n.depth?0:n.pos<=(n.start(p+1)+n.end(p+1))/2?-1:1,h=n.index(p)+(a>0?1:0),c=n.node(p),f=!1;if(1==s)f=c.canReplace(h,h,o);else{var u=c.contentMatchAt(h).findWrapping(o.firstChild.type);f=u&&c.canReplaceWith(h,h,u[0])}if(f)return 0==a?n.pos:a<0?n.before(p+1):n.after(p+1)}return null},f:function(t,e,r,n){void 0===n&&(n=t);var o=function(t,e){var r=t.parent,n=t.startIndex,o=t.endIndex,i=r.contentMatchAt(n).findWrapping(e);if(!i)return null;var s=i.length?i[0]:e;return r.canReplaceWith(n,o,s)?i:null}(t,e),i=o&&function(t,e){var r=t.parent,n=t.startIndex,o=t.endIndex,i=r.child(n),s=e.contentMatch.findWrapping(i.type);if(!s)return null;for(var p=(s.length?s[s.length-1]:e).contentMatch,a=n;p&&a<o;a++)p=p.matchType(r.child(a).type);return p&&p.validEnd?s:null}(n,e);return i?o.map(k).concat({type:e,attrs:r}).concat(i.map(k)):null},l:function(t){for(var e=t.parent.content.cutByIndex(t.startIndex,t.endIndex),r=t.depth;;--r){var n=t.$from.node(r),o=t.$from.index(r),i=t.$to.indexAfter(r);if(r<t.depth&&n.canReplace(o,i,e))return r;if(0==r||n.type.spec.isolating||!S(n,o,i))break}}});var i=Math.pow(2,16);function s(t){return 65535&t}var p=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=null),this.pos=t,this.deleted=e,this.recover=r},a=t("S",(function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e}));a.prototype.recover=function(t){var e=0,r=s(t);if(!this.inverted)for(var n=0;n<r;n++)e+=this.ranges[3*n+2]-this.ranges[3*n+1];return this.ranges[3*r]+e+function(t){return(t-(65535&t))/i}(t)},a.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},a.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},a.prototype._map=function(t,e,r){for(var n=0,o=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var h=this.ranges[a]-(this.inverted?n:0);if(h>t)break;var c=this.ranges[a+o],f=this.ranges[a+s],u=h+c;if(t<=u){var l=h+n+((c?t==h?-1:t==u?1:e:e)<0?0:f);if(r)return l;var d=t==(e<0?h:u)?null:a/3+(t-h)*i;return new p(l,e<0?t!=h:t!=u,d)}n+=f-c}return r?t+n:new p(t+n)},a.prototype.touches=function(t,e){for(var r=0,n=s(e),o=this.inverted?2:1,i=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var a=this.ranges[p]-(this.inverted?r:0);if(a>t)break;var h=this.ranges[p+o];if(t<=a+h&&p==3*n)return!0;r+=this.ranges[p+i]-h}return!1},a.prototype.forEach=function(t){for(var e=this.inverted?2:1,r=this.inverted?1:2,n=0,o=0;n<this.ranges.length;n+=3){var i=this.ranges[n],s=i-(this.inverted?o:0),p=i+(this.inverted?0:o),a=this.ranges[n+e],h=this.ranges[n+r];t(s,s+a,p,p+h),o+=h-a}},a.prototype.invert=function(){return new a(this.ranges,!this.inverted)},a.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},a.offset=function(t){return 0==t?a.empty:new a(t<0?[0,-t,0]:[0,0,t])},a.empty=new a([]);var h=t("M",(function(t,e,r,n){this.maps=t||[],this.from=r||0,this.to=null==n?this.maps.length:n,this.mirror=e}));function c(t){var e=Error.call(this,t);return e.__proto__=c.prototype,e}h.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new h(this.maps,this.mirror,t,e)},h.prototype.copy=function(){return new h(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},h.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},h.prototype.appendMapping=function(t){for(var e=0,r=this.maps.length;e<t.maps.length;e++){var n=t.getMirror(e);this.appendMap(t.maps[e],null!=n&&n<e?r+n:null)}},h.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},h.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},h.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){var n=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=n&&n>e?r-n-1:null)}},h.prototype.invert=function(){var t=new h;return t.appendMappingInverted(this),t},h.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t},h.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},h.prototype._map=function(t,e,r){for(var n=!1,o=this.from;o<this.to;o++){var i=this.maps[o].mapResult(t,e);if(null!=i.recover){var s=this.getMirror(o);if(null!=s&&s>o&&s<this.to){o=s,t=this.maps[s].recover(i.recover);continue}}i.deleted&&(n=!0),t=i.pos}return r?t:new p(t,n)},c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c.prototype.name="TransformError";var f=t("T",(function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new h})),u={before:{configurable:!0},docChanged:{configurable:!0}};function l(){throw new Error("Override me")}u.before.get=function(){return this.docs.length?this.docs[0]:this.doc},f.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new c(e.failed);return this},f.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},u.docChanged.get=function(){return this.steps.length>0},f.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(f.prototype,u);var d=Object.create(null),m=function(){};m.prototype.apply=function(t){return l()},m.prototype.getMap=function(){return a.empty},m.prototype.invert=function(t){return l()},m.prototype.map=function(t){return l()},m.prototype.merge=function(t){return null},m.prototype.toJSON=function(){return l()},m.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=d[e.stepType];if(!r)throw new RangeError("No step type "+e.stepType+" defined");return r.fromJSON(t,e)},m.jsonID=function(t,e){if(t in d)throw new RangeError("Duplicate use of step JSON ID "+t);return d[t]=e,e.prototype.jsonID=t,e};var v=function(t,e){this.doc=t,this.failed=e};v.ok=function(t){return new v(t,null)},v.fail=function(t){return new v(null,t)},v.fromReplace=function(t,e,r,n){try{return v.ok(t.replace(e,r,n))}catch(i){if(i instanceof o)return v.fail(i.message);throw i}};var y=t("a",function(t){function e(e,r,n,o){t.call(this),this.from=e,this.to=r,this.slice=n,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&w(t,this.from,this.to)?v.fail("Structure replace would overwrite content"):v.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new a([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var r=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return r.deleted&&n.deleted?null:new e(r.pos,Math.max(r.pos,n.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?r.empty:new r(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var o=this.slice.size+t.slice.size==0?r.empty:new r(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),o,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,r.fromJSON(t,n.slice),!!n.structure)},e}(m));m.jsonID("replace",y);var g=t("R",function(t){function e(e,r,n,o,i,s,p){t.call(this),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!p}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(w(t,this.from,this.gapFrom)||w(t,this.gapTo,this.to)))return v.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return v.fail("Gap is not a flat range");var r=this.slice.insertAt(this.insert,e.content);return r?v.fromReplace(t,this.from,this.to,r):v.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new a([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var r=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+r,this.from+this.insert,this.from+this.insert+r,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var r=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return r.deleted&&n.deleted||o<r.pos||i>n.pos?null:new e(r.pos,n.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,r.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(m));function w(t,e,r){for(var n=t.resolve(e),o=r-e,i=n.depth;o>0&&i>0&&n.indexAfter(i)==n.node(i).childCount;)i--,o--;if(o>0)for(var s=n.node(i).maybeChild(n.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function S(t,e,r){return(0==e||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function k(t){return{type:t,attrs:null}}function M(t,r,n){for(var o=[],i=0;i<t.childCount;i++){var s=t.child(i);s.content.size&&(s=s.copy(M(s.content,r,s))),s.isInline&&(s=r(s,n,i)),o.push(s)}return e.fromArray(o)}m.jsonID("replaceAround",g),f.prototype.lift=function(t,n){for(var o=t.$from,i=t.$to,s=t.depth,p=o.before(s+1),a=i.after(s+1),h=p,c=a,f=e.empty,u=0,l=s,d=!1;l>n;l--)d||o.index(l)>0?(d=!0,f=e.from(o.node(l).copy(f)),u++):h--;for(var m=e.empty,v=0,y=s,w=!1;y>n;y--)w||i.after(y+1)<i.end(y)?(w=!0,m=e.from(i.node(y).copy(m)),v++):c++;return this.step(new g(h,c,p,a,new r(f.append(m),u,v),f.size-u,!0))},f.prototype.wrap=function(t,n){for(var o=e.empty,i=n.length-1;i>=0;i--)o=e.from(n[i].type.create(n[i].attrs,o));var s=t.start,p=t.end;return this.step(new g(s,p,s,p,new r(o,0,0),n.length,!0))},f.prototype.setBlockType=function(t,n,o,i){var s=this;if(void 0===n&&(n=t),!o.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var p=this.steps.length;return this.doc.nodesBetween(t,n,(function(t,n){if(t.isTextblock&&!t.hasMarkup(o,i)&&function(t,e,r){var n=t.resolve(e),o=n.index();return n.parent.canReplaceWith(o,o+1,r)}(s.doc,s.mapping.slice(p).map(n),o)){s.clearIncompatible(s.mapping.slice(p).map(n,1),o);var a=s.mapping.slice(p),h=a.map(n,1),c=a.map(n+t.nodeSize,1);return s.step(new g(h,c,h+1,c-1,new r(e.from(o.create(i,null,t.marks)),0,0),1,!0)),!1}})),this},f.prototype.setNodeMarkup=function(t,n,o,i){var s=this.doc.nodeAt(t);if(!s)throw new RangeError("No node at given position");n||(n=s.type);var p=n.create(o,null,i||s.marks);if(s.isLeaf)return this.replaceWith(t,t+s.nodeSize,p);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);return this.step(new g(t,t+s.nodeSize,t+1,t+s.nodeSize-1,new r(e.from(p),0,0),1,!0))},f.prototype.split=function(t,n,o){void 0===n&&(n=1);for(var i=this.doc.resolve(t),s=e.empty,p=e.empty,a=i.depth,h=i.depth-n,c=n-1;a>h;a--,c--){s=e.from(i.node(a).copy(s));var f=o&&o[c];p=e.from(f?f.type.create(f.attrs,p):i.node(a).copy(p))}return this.step(new y(t,t,new r(s.append(p),n,n),!0))},f.prototype.join=function(t,e){void 0===e&&(e=1);var n=new y(t-e,t+e,r.empty,!0);return this.step(n)};var C=function(t){function e(e,r,n){t.call(this),this.from=e,this.to=r,this.mark=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),o=t.resolve(this.from),i=o.node(o.sharedDepth(this.to)),s=new r(M(n.content,(function(t,r){return t.isAtom&&r.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),i),n.openStart,n.openEnd);return v.fromReplace(t,this.from,this.to,s)},e.prototype.invert=function(){return new b(this.from,this.to,this.mark)},e.prototype.map=function(t){var r=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new e(r.pos,n.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,r){if("number"!=typeof r.from||"number"!=typeof r.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(r.from,r.to,t.markFromJSON(r.mark))},e}(m);m.jsonID("addMark",C);var b=function(t){function e(e,r,n){t.call(this),this.from=e,this.to=r,this.mark=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),o=new r(M(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return v.fromReplace(t,this.from,this.to,o)},e.prototype.invert=function(){return new C(this.from,this.to,this.mark)},e.prototype.map=function(t){var r=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new e(r.pos,n.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,r){if("number"!=typeof r.from||"number"!=typeof r.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(r.from,r.to,t.markFromJSON(r.mark))},e}(m);function R(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}m.jsonID("removeMark",b),f.prototype.addMark=function(t,e,r){var n=this,o=[],i=[],s=null,p=null;return this.doc.nodesBetween(t,e,(function(n,a,h){if(n.isInline){var c=n.marks;if(!r.isInSet(c)&&h.type.allowsMarkType(r.type)){for(var f=Math.max(a,t),u=Math.min(a+n.nodeSize,e),l=r.addToSet(c),d=0;d<c.length;d++)c[d].isInSet(l)||(s&&s.to==f&&s.mark.eq(c[d])?s.to=u:o.push(s=new b(f,u,c[d])));p&&p.to==f?p.to=u:i.push(p=new C(f,u,r))}}})),o.forEach((function(t){return n.step(t)})),i.forEach((function(t){return n.step(t)})),this},f.prototype.removeMark=function(t,e,r){var o=this;void 0===r&&(r=null);var i=[],s=0;return this.doc.nodesBetween(t,e,(function(o,p){if(o.isInline){s++;var a=null;if(r instanceof n)for(var h,c=o.marks;h=r.isInSet(c);)(a||(a=[])).push(h),c=h.removeFromSet(c);else r?r.isInSet(o.marks)&&(a=[r]):a=o.marks;if(a&&a.length)for(var f=Math.min(p+o.nodeSize,e),u=0;u<a.length;u++){for(var l=a[u],d=void 0,m=0;m<i.length;m++){var v=i[m];v.step==s-1&&l.eq(i[m].style)&&(d=v)}d?(d.to=f,d.step=s):i.push({style:l,from:Math.max(p,t),to:f,step:s})}}})),i.forEach((function(t){return o.step(new b(t.from,t.to,t.style))})),this},f.prototype.clearIncompatible=function(t,n,o){void 0===o&&(o=n.contentMatch);for(var i=this.doc.nodeAt(t),s=[],p=t+1,a=0;a<i.childCount;a++){var h=i.child(a),c=p+h.nodeSize,f=o.matchType(h.type,h.attrs);if(f){o=f;for(var u=0;u<h.marks.length;u++)n.allowsMarkType(h.marks[u].type)||this.step(new b(p,c,h.marks[u]))}else s.push(new y(p,c,r.empty));p=c}if(!o.validEnd){var l=o.fillBefore(e.empty,!0);this.replace(p,p,new r(l,0,0))}for(var d=s.length-1;d>=0;d--)this.step(s[d]);return this},f.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=r.empty);var o=function(t,e,n,o){if(void 0===n&&(n=e),void 0===o&&(o=r.empty),e==n&&!o.size)return null;var i=t.resolve(e),s=t.resolve(n);return R(i,s,o)?new y(e,n,o):new x(i,s,o).fit()}(this.doc,t,e,n);return o&&this.step(o),this},f.prototype.replaceWith=function(t,n,o){return this.replace(t,n,new r(e.from(o),0,0))},f.prototype.delete=function(t,e){return this.replace(t,e,r.empty)},f.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var x=function(t,r,n){this.$to=r,this.$from=t,this.unplaced=n,this.frontier=[];for(var o=0;o<=t.depth;o++){var i=t.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(t.indexAfter(o))})}this.placed=e.empty;for(var s=t.depth;s>0;s--)this.placed=e.from(t.node(s).copy(this.placed))},N={depth:{configurable:!0}};function T(t,e,r){return 0==e?t.cutByIndex(r):t.replaceChild(0,t.firstChild.copy(T(t.firstChild.content,e-1,r)))}function O(t,e,r){return 0==e?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(O(t.lastChild.content,e-1,r)))}function I(t,e){for(var r=0;r<e;r++)t=t.firstChild.content;return t}function z(t,r,n){if(r<=0)return t;var o=t.content;return r>1&&(o=o.replaceChild(0,z(o.firstChild,r-1,1==o.childCount?n-1:0))),r>0&&(o=t.type.contentMatch.fillBefore(o).append(o),n<=0&&(o=o.append(t.type.contentMatch.matchFragment(o).fillBefore(e.empty,!0)))),t.copy(o)}function E(t,e,r,n,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!r.compatibleContent(i.type))return null;var p=n.fillBefore(i.content,!0,s);return p&&!function(t,e,r){for(var n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}(r,i.content,s)?p:null}function F(t,r,n,o,i){if(r<n){var s=t.firstChild;t=t.replaceChild(0,s.copy(F(s.content,r+1,n,o,s)))}if(r>o){var p=i.contentMatchAt(0),a=p.fillBefore(t).append(t);t=a.append(p.matchFragment(a).fillBefore(e.empty,!0))}return t}function J(t,e){for(var r=[],n=Math.min(t.depth,e.depth);n>=0;n--){var o=t.start(n);if(o<t.pos-(t.depth-n)||e.end(n)>e.pos+(e.depth-n)||t.node(n).type.spec.isolating||e.node(n).type.spec.isolating)break;o==e.start(n)&&r.push(n)}return r}N.depth.get=function(){return this.frontier.length-1},x.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,o=this.$from,i=this.close(e<0?this.$to:o.doc.resolve(e));if(!i)return null;for(var s=this.placed,p=o.depth,a=i.depth;p&&a&&1==s.childCount;)s=s.firstChild.content,p--,a--;var h=new r(s,p,a);return e>-1?new g(o.pos,e,this.$to.pos,this.$to.end(),h,n):h.size||o.pos!=this.$to.pos?new y(o.pos,i.pos,h):void 0},x.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var r=this.unplaced.openStart;r>=0;r--)for(var n=void 0,o=(r?(n=I(this.unplaced.content,r-1).firstChild).content:this.unplaced.content).firstChild,i=this.depth;i>=0;i--){var s=this.frontier[i],p=s.type,a=s.match,h=void 0,c=void 0;if(1==t&&(o?a.matchType(o.type)||(c=a.fillBefore(e.from(o),!1)):p.compatibleContent(n.type)))return{sliceDepth:r,frontierDepth:i,parent:n,inject:c};if(2==t&&o&&(h=a.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:i,parent:n,wrap:h};if(n&&a.matchType(n.type))break}},x.prototype.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,o=t.openEnd,i=I(e,n);return!(!i.childCount||i.firstChild.isLeaf||(this.unplaced=new r(e,n+1,Math.max(o,i.size+n>=e.size-o?n+1:0)),0))},x.prototype.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,o=t.openEnd,i=I(e,n);if(i.childCount<=1&&n>0){var s=e.size-n<=n+i.size;this.unplaced=new r(T(e,n-1,1),n-1,s?n-1:o)}else this.unplaced=new r(T(e,n,1),n,o)},x.prototype.placeNodes=function(t){for(var n=t.sliceDepth,o=t.frontierDepth,i=t.parent,s=t.inject,p=t.wrap;this.depth>o;)this.closeFrontierNode();if(p)for(var a=0;a<p.length;a++)this.openFrontierNode(p[a]);var h=this.unplaced,c=i?i.content:h.content,f=h.openStart-n,u=0,l=[],d=this.frontier[o],m=d.match,v=d.type;if(s){for(var y=0;y<s.childCount;y++)l.push(s.child(y));m=m.matchFragment(s)}for(var g=c.size+n-(h.content.size-h.openEnd);u<c.childCount;){var w=c.child(u),S=m.matchType(w.type);if(!S)break;(++u>1||0==f||w.content.size)&&(m=S,l.push(z(w.mark(v.allowedMarks(w.marks)),1==u?f:0,u==c.childCount?g:-1)))}var k=u==c.childCount;k||(g=-1),this.placed=O(this.placed,o,e.from(l)),this.frontier[o].match=m,k&&g<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var M=0,C=c;M<g;M++){var b=C.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),C=b.content}this.unplaced=k?0==n?r.empty:new r(T(h.content,n-1,1),n-1,g<0?h.openEnd:n-1):new r(T(h.content,n,u),h.openStart,h.openEnd)},x.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!E(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var r=this.$to.depth,n=this.$to.after(r);r>1&&n==this.$to.end(--r);)++n;return n},x.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var r=this.frontier[e],n=r.match,o=r.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=E(t,e,o,n,i);if(s){for(var p=e-1;p>=0;p--){var a=this.frontier[p],h=a.match,c=E(t,p,a.type,h,!0);if(!c||c.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},x.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=O(this.placed,e.depth,e.fit)),t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var n=t.node(r),o=n.type.contentMatch.fillBefore(n.content,!0,t.index(r));this.openFrontierNode(n.type,n.attrs,o)}return t},x.prototype.openFrontierNode=function(t,r,n){var o=this.frontier[this.depth];o.match=o.match.matchType(t),this.placed=O(this.placed,this.depth,e.from(t.create(r,n))),this.frontier.push({type:t,match:t.contentMatch})},x.prototype.closeFrontierNode=function(){var t=this.frontier.pop().match.fillBefore(e.empty,!0);t.childCount&&(this.placed=O(this.placed,this.frontier.length,t))},Object.defineProperties(x.prototype,N),f.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var o=this.doc.resolve(t),i=this.doc.resolve(e);if(R(o,i,n))return this.step(new y(t,e,n));var s=J(o,this.doc.resolve(e));0==s[s.length-1]&&s.pop();var p=-(o.depth+1);s.unshift(p);for(var a=o.depth,h=o.pos-1;a>0;a--,h--){var c=o.node(a).type.spec;if(c.defining||c.isolating)break;s.indexOf(a)>-1?p=a:o.before(a)==h&&s.splice(1,0,-a)}for(var f=s.indexOf(p),u=[],l=n.openStart,d=n.content,m=0;;m++){var v=d.firstChild;if(u.push(v),m==n.openStart)break;d=v.content}l>0&&u[l-1].type.spec.defining&&o.node(f).type!=u[l-1].type?l-=1:l>=2&&u[l-1].isTextblock&&u[l-2].type.spec.defining&&o.node(f).type!=u[l-2].type&&(l-=2);for(var g=n.openStart;g>=0;g--){var w=(g+l+1)%(n.openStart+1),S=u[w];if(S)for(var k=0;k<s.length;k++){var M=s[(k+f)%s.length],C=!0;M<0&&(C=!1,M=-M);var b=o.node(M-1),x=o.index(M-1);if(b.canReplaceWith(x,x,S.type,S.marks))return this.replace(o.before(M),C?i.after(M):e,new r(F(n.content,0,n.openStart,w),w,n.openEnd))}}for(var N=this.steps.length,T=s.length-1;T>=0&&(this.replace(t,e,n),!(this.steps.length>N));T--){var O=s[T];O<0||(t=o.before(O),e=i.after(O))}return this},f.prototype.replaceRangeWith=function(t,n,o){if(!o.isInline&&t==n&&this.doc.resolve(t).parent.content.size){var i=function(t,e,r){var n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(0==n.parentOffset)for(var o=n.depth-1;o>=0;o--){var i=n.index(o);if(n.node(o).canReplaceWith(i,i,r))return n.before(o+1);if(i>0)return null}if(n.parentOffset==n.parent.content.size)for(var s=n.depth-1;s>=0;s--){var p=n.indexAfter(s);if(n.node(s).canReplaceWith(p,p,r))return n.after(s+1);if(p<n.node(s).childCount)return null}}(this.doc,t,o.type);null!=i&&(t=n=i)}return this.replaceRange(t,n,new r(e.from(o),0,0))},f.prototype.deleteRange=function(t,e){for(var r=this.doc.resolve(t),n=this.doc.resolve(e),o=J(r,n),i=0;i<o.length;i++){var s=o[i],p=i==o.length-1;if(p&&0==s||r.node(s).type.contentMatch.validEnd)return this.delete(r.start(s),n.end(s));if(s>0&&(p||r.node(s-1).canReplace(r.index(s-1),n.indexAfter(s-1))))return this.delete(r.before(s),n.after(s))}for(var a=1;a<=r.depth&&a<=n.depth;a++)if(t-r.start(a)==r.depth-a&&e>r.end(a)&&n.end(a)-e!=n.depth-a)return this.delete(r.before(a),e);return this.delete(t,e)}}}}));
