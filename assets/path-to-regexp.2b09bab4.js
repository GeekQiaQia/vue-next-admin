function e(e,r){void 0===r&&(r={});for(var t=function(e){for(var r=[],t=0;t<e.length;){var n=e[t];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)r.push({type:"CHAR",index:t,value:e[t++]});else{var i=1,a="";if("?"===e[f=t+1])throw new TypeError('Pattern cannot start with "?" at '+f);for(;f<e.length;)if("\\"!==e[f]){if(")"===e[f]){if(0==--i){f++;break}}else if("("===e[f]&&(i++,"?"!==e[f+1]))throw new TypeError("Capturing groups are not allowed at "+f);a+=e[f++]}else a+=e[f++]+e[f++];if(i)throw new TypeError("Unbalanced pattern at "+t);if(!a)throw new TypeError("Missing pattern at "+t);r.push({type:"PATTERN",index:t,value:a}),t=f}else{for(var o="",f=t+1;f<e.length;){var p=e.charCodeAt(f);if(!(p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||95===p))break;o+=e[f++]}if(!o)throw new TypeError("Missing parameter name at "+t);r.push({type:"NAME",index:t,value:o}),t=f}else r.push({type:"CLOSE",index:t,value:e[t++]});else r.push({type:"OPEN",index:t,value:e[t++]});else r.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else r.push({type:"MODIFIER",index:t,value:e[t++]})}return r.push({type:"END",index:t,value:""}),r}(e),n=r.prefixes,i=void 0===n?"./":n,a="[^"+function(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}(r.delimiter||"/#?")+"]+?",o=[],f=0,p=0,u="",s=function(e){if(p<t.length&&t[p].type===e)return t[p++].value},l=function(e){var r=s(e);if(void 0!==r)return r;var n=t[p],i=n.type,a=n.index;throw new TypeError("Unexpected "+i+" at "+a+", expected "+e)},v=function(){for(var e,r="";e=s("CHAR")||s("ESCAPED_CHAR");)r+=e;return r};p<t.length;){var E=s("CHAR"),d=s("NAME"),h=s("PATTERN");if(d||h){var y=E||"";-1===i.indexOf(y)&&(u+=y,y=""),u&&(o.push(u),u=""),o.push({name:d||f++,prefix:y,suffix:"",pattern:h||a,modifier:s("MODIFIER")||""})}else{var c=E||s("ESCAPED_CHAR");if(c)u+=c;else if(u&&(o.push(u),u=""),s("OPEN")){y=v();var x=s("NAME")||"",w=s("PATTERN")||"",m=v();l("CLOSE"),o.push({name:x||(w?f++:""),pattern:x&&!w?a:w,prefix:y,suffix:m,modifier:s("MODIFIER")||""})}else l("END")}}return o}function r(r,t){return function(e,r){void 0===r&&(r={});var t=function(e){return e&&e.sensitive?"":"i"}(r),n=r.encode,i=void 0===n?function(e){return e}:n,a=r.validate,o=void 0===a||a,f=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",t)}));return function(r){for(var t="",n=0;n<e.length;n++){var a=e[n];if("string"!=typeof a){var p=r?r[a.name]:void 0,u="?"===a.modifier||"*"===a.modifier,s="*"===a.modifier||"+"===a.modifier;if(Array.isArray(p)){if(!s)throw new TypeError('Expected "'+a.name+'" to not repeat, but got an array');if(0===p.length){if(u)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var l=0;l<p.length;l++){var v=i(p[l],a);if(o&&!f[n].test(v))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'", but got "'+v+'"');t+=a.prefix+v+a.suffix}}else if("string"!=typeof p&&"number"!=typeof p){if(!u){var E=s?"an array":"a string";throw new TypeError('Expected "'+a.name+'" to be '+E)}}else{v=i(String(p),a);if(o&&!f[n].test(v))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+v+'"');t+=a.prefix+v+a.suffix}}else t+=a}return t}}(e(r,t),t)}export{r as c};
